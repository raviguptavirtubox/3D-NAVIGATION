<!DOCTYPE html>
<html>
  <head>
    <title>360 Walkthrough</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 9999;
        display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
      }
      button { padding: 20px 40px; font-size: 20px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }
    </style>
  </head>
  <body>

    <div id="overlay">
      <h1>360 Tour</h1>
      <p>Look around to find the navigation arrows</p>
      <button onclick="startScene()">ENTER TOUR</button>
    </div>

    <a-scene id="scene" style="display: none;" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
      
      <a-assets>
        <img id="img-start" src="start.jpg">
        <img id="img-middle" src="middle.jpg">
        <img id="img-end" src="end.jpg">
        <img id="arrow" src="https://img.icons8.com/m_sharp/200/FFFFFF/up.png">
      </a-assets>

      <a-sky id="main-sky" src="#img-start" rotation="0 -90 0"></a-sky>

      <a-text id="status-text" value="You are here: Start" align="center" position="0 2 -3" width="6"></a-text>

      <a-entity id="nav-group">
        
        <a-entity id="arrow-middle-container" position="0 -1.5 -4">
            <a-image src="#arrow" rotation="-90 0 0" class="clickable" onclick="moveRoom('middle')"></a-image>
            <a-text value="GO TO MIDDLE" align="center" position="0 0.5 0" scale="1.5 1.5 1.5"></a-text>
        </a-entity>

      </a-entity>

      <a-text id="dest-text" value="DESTINATION REACHED" align="center" position="0 1.5 -3" color="#4CAF50" width="10" visible="false"></a-text>

      <a-entity camera look-controls>
        <a-cursor color="yellow" raycaster="objects: .clickable"></a-cursor>
      </a-entity>
    </a-scene>

    <script>
      function startScene() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('scene').style.display = 'block';
        // Force refresh for A-Frame to render the images
        document.querySelector('a-scene').resize();
      }

      function moveRoom(roomName) {
        const sky = document.querySelector('#main-sky');
        const statusText = document.querySelector('#status-text');
        const middleArrow = document.querySelector('#arrow-middle-container');
        const destText = document.querySelector('#dest-text');

        if (roomName === 'middle') {
          // Change to Middle Image
          sky.setAttribute('src', '#img-middle');
          statusText.setAttribute('value', 'You are here: Middle');
          
          // Update the arrow to point to the END image instead
          // We change the onclick function to 'end'
          const arrowImg = middleArrow.querySelector('a-image');
          const arrowText = middleArrow.querySelector('a-text');
          
          arrowText.setAttribute('value', 'GO TO END');
          arrowImg.setAttribute('onclick', "moveRoom('end')");
          
          // Move the arrow position if the door is in a different spot in the middle room
          middleArrow.setAttribute('position', '2 -1.5 -3'); 
        } 
        else if (roomName === 'end') {
          // Change to End Image
          sky.setAttribute('src', '#img-end');
          middleArrow.setAttribute('visible', 'false');
          statusText.setAttribute('visible', 'false');
          destText.setAttribute('visible', 'true');
        }
      }
    </script>
  </body>
</html>
